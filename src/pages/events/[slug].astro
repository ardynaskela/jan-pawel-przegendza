---
import { getCollection, getEntryBySlug } from "astro:content";
import { marked } from "marked";

export async function getStaticPaths() {
  const items = await getCollection("events");
  return items.map((i: any) => ({ params: { slug: i.slug } }));
}

const { slug } = Astro.params;
if (!slug) throw new Error("Slug is required");

const entry = await getEntryBySlug("events", slug);
if (!entry) throw new Error("Not found");

const { title, date, description } = entry.data;

// Bezpieczne parsowanie daty
const eventDate = typeof date === 'string' ? new Date(date) : date;

const titleHtml = marked.parse(title);
const descHtml = description ? marked.parse(description) : "";
---

<time datetime={eventDate.toISOString()}>
  {eventDate.toLocaleDateString("en-GB", {
    year: "numeric",
    month: "long",
    day: "numeric"
  })}, {eventDate.toLocaleTimeString("en-GB", {
    hour: "2-digit",
    minute: "2-digit"
  })}
</time>

<h1 set:html={titleHtml} />
{description ? <div set:html={descHtml} /> : null}
